@model List<webCore.Models.Voucher>
@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Voucher</title>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
          integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
          crossorigin="anonymous"
          referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
          integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N"
          crossorigin="anonymous" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="~/css/voucher.css" asp-append-version="true" />
 
</head>
<body>
    <div class="container my-5">
        <!-- Main container for all promotions (wrapped in a single card) -->
        <div class="card promotions-card shadow-sm">
            <div class="card-body">
                <h5 class="card-title text-center">Khuyến mãi hiện có</h5>

                <div class="row g-3">
                    <!-- Loop through the vouchers and display each voucher -->
                    @foreach (var voucher in Model)
                    {
                        <div class="col-6 col-md-4 col-lg-2">
                            <div class="card shadow-sm h-100">
                                <div class="card-body">
                                    <p class="card-text">
                                        @if (voucher.DiscountType == "Percentage")
                                        {
                                            @($"{voucher.DiscountValue} % Giảm giá")
                                        }
                                        else
                                        {
                                            @($"{voucher.DiscountValue:C} Giảm giá")
                                        }

                                    </p>
                                    <p class="card-text">Áp dụng từ: @voucher.StartDate.ToString("dd/MM/yyyy")</p>
                                    <p class="card-text">Đến: @voucher.EndDate.ToString("dd/MM/yyyy")</p>
                                    <button class="btn btn-primary w-100 apply-voucher" data-discount="@voucher.DiscountValue" data-discount-type="@voucher.DiscountType">Áp dụng</button>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <script>
        document.querySelectorAll('.apply-voucher').forEach(button => {
            button.addEventListener('click', function () {
                const discount = this.getAttribute('data-discount');
                const discountType = this.getAttribute('data-discount-type');

                // Gửi dữ liệu voucher đến server bằng AJAX
                fetch('@Url.Action("ApplyVoucher", "VoucherClient")', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded' // Đảm bảo đúng loại dữ liệu
                    },
                    body: `discount=${discount}&discountType=${discountType}` // Truyền đúng dữ liệu
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Nếu yêu cầu thành công, chuyển hướng về trang giỏ hàng
                        window.location.href = '@Url.Action("Cart", "Cart")';
                    } else {
                        // Xử lý nếu có lỗi
                        alert(data.message);
                    }
                })
                .catch(error => console.error('Error:', error));
            });
        });
    </script>
</body>
</html>